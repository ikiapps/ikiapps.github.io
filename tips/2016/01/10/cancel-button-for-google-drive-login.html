<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <meta name="author" content="ikiApps LLC, 粋アプリ, d108(सोऽहम्)"> <meta name="description" content="In working with the Google Drive SDK for iOS, one can appreciate its broad support for many different use cases including multiple iOS versions. Perhaps furt..."> <title>Making It So Users Can Cancel a Google Drive Login on iOS 9</title> <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet"> <!--[if lt IE 9]> <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script> <![endif]--> <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed"> <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed"> <link rel="stylesheet" href="/css/main.css" type="text/css"> <link rel="canonical" href="/tips/2016/01/10/cancel-button-for-google-drive-login"> <link rel="shortcut icon" href="/favicon.ico"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40712418-2', 'auto'); ga('send', 'pageview'); </script> <script src="/js/jquery-3.2.0.min.js"></script> </head> <body> <nav class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <div class="navbar-image"><a href="/"><img src="/assets/themes/bootstrap/iki-circle-logo.png" width="40"/></a></div> <a class="navbar-brand" href="/">ikiApps</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href="/blog/">Blog</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/tags">Tags</a></li> <li><a href="/search/">Search</a></li> </ul> </div> </div> </nav> <div class="container"> <div class="page-header"> <h1>Making It So Users Can Cancel a Google Drive Login on iOS 9 </h1> </div> <div class="row post-full"> <div class="col-md-12"> <div class="date"> <span>10 January 2016</span> </div> <div class="content"> <p>In working with the Google Drive SDK for iOS, one can appreciate its broad support for many different use cases including multiple iOS versions. Perhaps further updates are necessary as using the library in a Swift world requires significant effort.</p> <p>After successfully integrating the SDK into a production app I can share some tips for making it a smoother experience.</p> <p>For reference, the install guide by Google can be found <a href="https://developers.google.com/drive/ios/quickstart?ver=swift">here</a>.</p> <hr /> <p>The OAuth2-based login screen had a UI problem where it wasn’t showing a cancel button thereby preventing cancellation of the login by users.</p> <p>I’m listing some changes to <code>GTMOAuth2ViewControllerTouch.m</code> that will add a cancel button to the login screen.</p> <figure class="highlight"><pre><code class="language-objective-c" data-lang="objective-c"><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">setUpNavigation</span><span class="p">];</span>

    <span class="c1">// ADD THIS CODE TO THIS METHOD:</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">navigationController</span><span class="p">.</span><span class="n">navigationBar</span> <span class="nl">setTitleTextAttributes</span><span class="p">:</span><span class="l">@{</span>
        <span class="nl">NSForegroundColorAttributeName</span> <span class="p">:</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">blueColor</span><span class="p">]</span>
    <span class="l">}</span><span class="p">];</span>    
    <span class="nb">self</span><span class="p">.</span><span class="n">navigationController</span><span class="p">.</span><span class="n">navigationBar</span><span class="p">.</span><span class="n">translucent</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>

    <span class="n">CGFloat</span> <span class="n">deviceWidth</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
    <span class="n">CGFloat</span> <span class="n">navBarHeight</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
    <span class="bp">UINavigationBar</span> <span class="o">*</span><span class="n">navBar</span> <span class="o">=</span> 
        <span class="p">[[</span><span class="bp">UINavigationBar</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                                                          <span class="n">deviceWidth</span><span class="p">,</span> <span class="n">navBarHeight</span><span class="p">)];</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span> <span class="nl">addSubview</span><span class="p">:</span><span class="n">navBar</span><span class="p">];</span>

    <span class="bp">UIBarButtonItem</span> <span class="o">*</span><span class="n">cancelItem</span> <span class="o">=</span> 
        <span class="p">[[</span><span class="bp">UIBarButtonItem</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle</span><span class="p">:[</span><span class="bp">NSString</span> 
                                 <span class="nl">stringWithFormat</span><span class="p">:</span><span class="n">NSLocalizedString</span><span class="p">(</span><span class="s">@&quot;Cancel&quot;</span><span class="p">,</span> <span class="nb">nil</span><span class="p">)]</span>
                                 <span class="nl">style</span><span class="p">:</span><span class="n">UIBarButtonItemStylePlain</span> <span class="nl">target</span><span class="p">:</span><span class="nb">self</span>
                                 <span class="nl">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">cancelLogin</span><span class="p">:)];</span>                                 
    <span class="bp">UINavigationItem</span> <span class="o">*</span><span class="n">navBarItem</span> <span class="o">=</span> 
        <span class="p">[[</span><span class="bp">UINavigationItem</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTitle</span><span class="p">:</span><span class="s">@&quot;Google Drive&quot;</span><span class="p">];</span>
    <span class="n">navBarItem</span><span class="p">.</span><span class="n">rightBarButtonItem</span> <span class="o">=</span> <span class="n">cancelItem</span><span class="p">;</span>
    <span class="n">navBar</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSArray</span> <span class="nl">arrayWithObjects</span><span class="p">:</span><span class="n">navBarItem</span><span class="p">,</span> <span class="nb">nil</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// ADD THIS METHOD:</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">cancelLogin:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">dismissViewControllerAnimated</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">completion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setUpNavigation</span>
<span class="p">{</span>
    <span class="n">rightBarButtonItem_</span><span class="p">.</span><span class="n">customView</span> <span class="o">=</span> <span class="n">navButtonsView_</span><span class="p">;</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">navigationItem</span><span class="p">.</span><span class="n">rightBarButtonItem</span> <span class="o">=</span> <span class="n">rightBarButtonItem_</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <hr /> <p>The final result.</p> <p><img src="/img/2016-01-10-cancel-button-for-google-drive-login/google-drive-login-with-cancel.png" alt="" /></p> </div> <ul class="tag_box inline"> <li><i class="icon-folder-open"></i></li> <li><a href="/categories#tips-ref"> tips <span>10</span> </a></li> </ul> <ul class="tag_box inline"> <li><i class="icon-tags"></i></li> <li><a href="/tags#ios-ref">ios <span>9</span></a></li> <li><a href="/tags#objective-c-ref">objective-c <span>1</span></a></li> <li><a href="/tags#swift-ref">swift <span>12</span></a></li> <li><a href="/tags#google-drive-sdk-ref">google-drive-sdk <span>1</span></a></li> </ul> <hr> <ul class="pagination"> <li class="prev"><a href="/experiences/2016/01/06/rac4-concurrency-lesson" title="ReactiveCocoa 4 Signals Teach Us an Important Lesson About Concurrency">&larr; Previous</a></li> <li><a href="/archive">Archive</a></li> <li class="next"><a href="/experiences/2016/01/15/mvvm-in-swift-with-reactivecocoa4" title="MVVM in Swift with ReactiveCocoa 4">Next &rarr;</a></li> </ul> <hr> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_developer = 1; var disqus_shortname = 'ikiapps'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a> </div> </div> <hr/> <footer> <div style="float: left; margin-top: 10px; margin-bottom: 45px;"> &copy; 2019 ikiApps LLC</div> <div style="float: right; margin-top: 10px; margin-bottom: 40px;"><a href="/contact" target="_blank">Contact</a></div> <div style="float: left; margin-top: 10px; margin-bottom: 40px;"><hr/></div> </footer> </div> <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script> </body> </html>
