<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <meta name="author" content="ikiApps LLC, ç²‹ã‚¢ãƒ—ãƒª, d108(à¤¸à¥‹à¤½à¤¹à¤®à¥)"> <meta name="description" content=" Figure 1: A stereo waveform with unexpected silence. "> <title>A Swift Script for Detecting Silence in Audio Files</title> <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet"> <!--[if lt IE 9]> <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script> <![endif]--> <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed"> <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed"> <link rel="stylesheet" href="/css/main.css" type="text/css"> <link rel="canonical" href="/open-source/2017/03/15/swift-script-for-detecting-silence-in-audio-files"> <link rel="shortcut icon" href="/favicon.ico"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40712418-2', 'auto'); ga('send', 'pageview'); </script> <script src="/js/jquery-3.2.0.min.js"></script> </head> <body> <nav class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <div class="navbar-image"><a href="/"><img src="/assets/themes/bootstrap/iki-circle-logo.png" width="40"/></a></div> <a class="navbar-brand" href="/">ikiApps</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href="/blog/">Blog</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/tags">Tags</a></li> <li><a href="/search/">Search</a></li> </ul> </div> </div> </nav> <div class="container"> <div class="page-header"> <h1>A Swift Script for Detecting Silence in Audio Files <br/><small>Made with Reactive Programming in RxSwift</small></h1> </div> <div class="row post-full"> <div class="col-md-12"> <div class="date"> <span>Updated on 01 June 2017</span> </div> <div class="content"> <p> <figure class="image"><img src="/img/2017-03-15-swift-script-for-detecting-silence-in-audio-files/sample-waveform-w-silence.png" alt="Figure 1: A stereo waveform with unexpected silence." /> <figcaption><strong>Figure 1: A stereo waveform with unexpected silence.</strong> </figcaption> </figure> </p> <p>Detecting silence in audio files is an essential capability to ensure correct audio processing. When handling large numbers of files, this can be a cumbersome and time-consuming task to perform manually. Iâ€™ve written a script in Swift to automate this job. It uses <code>ffmpeg</code> as a subprocess along with its <code>silencedetect</code> filter. Iâ€™ve written the script using Reactive Programming in Swift 3 and RxSwift. Itâ€™s capable of relatively fast, recursive scanning of huge numbers of files given a single starting point while reliably reporting all of its results to the console.</p> <p>This project is somewhat experimental since Mac command line tools do not yet have full support for linking external frameworks. The libraries for Swift still cannot be statically linked. Anything else containing Swift code cannot be built as a static framework. If a framework containing Swift code is linked, an external source of the Swift libraries must be provided. Thus, there is a high barrier to writing Swift scripts with RxSwift, but it is one that can be overcome.</p> <p>The choice to use reactive programming for this script was made due to the streaming nature of processing files and handling of audio data as streams. I had this dream where everything is a stream ðŸ˜Š. I will cover more aspects of reactive programming in a future tutorial.</p> <h2 id="silence">Silence</h2> <p>The following silence cases are supported:</p> <ol> <li>Silence occurring at the beginning of audio.</li> <li>Silence occurring in the middle of audio.</li> <li>Silence occurring at the end of audio.</li> </ol> <p>Complete silence should be detected as case (1). Another option for this is the <code>volumedetect</code> filter.</p> <h2 id="usage">Usage</h2> <p>Usage for the script is:</p><pre><code>$ detectSilence ${ANY_VALID_BASE_PATH} 2&gt;/dev/null
</code></pre><p>Here is a sample of the output:</p><pre><code>Silence found in file:///Audio-Files/2017-Mar-15/01.flac
    ðŸš© start -0.0410202, end 0.417959, duration 0.45898Â 
    total duration: 939.97
Silence found in file:///Audio-Files/2017-Mar-19/01.flac
    ðŸš© start 2081.81, end 2088.02, duration 6.20592
    total duration: 3005.23
Silence found in file:///Audio-Files/2017-Mar-17/02.flac
    ðŸš© start 301.103, end ðŸ”³, duration ðŸ”³
    total duration: 729.11
    â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰â–‰
</code></pre><p>The red flags indicate silences that have exceeded a given duration. The <code>silencedetect</code> filter can detect silences with no end or no duration. These usually correspond to silences at the end of a file. This type of silence is also graphically represented to show its relative length with respect to the total duration. The level at which audio is considered silence is set by a noise floor variable in units of dB in the script.</p> <h2 id="installation">Installation</h2> <h3 id="dependencies">Dependencies</h3> <p>The additional dependencies for this script beyond Xcode 8 are:</p> <ul> <li><a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> (installed by <a href="https://github.com/Carthage/Carthage">Carthage</a>)</li> <li><a href="https://trac.ffmpeg.org/wiki/CompilationGuide/MacOSX">ffmpeg</a> with the <code>silencedetect</code> filter</li> </ul> <p>Installation of RxSwift is accomplished with:</p><pre><code>$ carthage update
</code></pre><h3 id="make-the-binary">Make the binary</h3> <p>Build the project with Xcode. Show the Products folder in the Finder from Xcode. Copy the contents of the Products folder to a location of your choice. The <code>detectSilence</code> binary is needed along with the RxSwift.framework directory and its contents. The detectSilence.swiftmodule directory is not needed because the Swift libraries are accessed from the toolchain (the command-line tools) of Xcode. This is the external source mentioned in the introduction.</p> <p>That concludes the installation process. Once installed, the compiled script can be accessed as a normal command.</p> <h3 id="alternative-option-1-add-a-copy-files-phase">Alternative option 1: Add a Copy Files phase</h3> <p>Under build phases for the <code>detectSilence</code> target, add a Copy Files phase to copy the freshly built binary to an Absolute Path of your choice. Leave â€˜Copy only when installingâ€™ unchecked. With this phase added, every time the project is built, the binary will be updated in the destination location such as in <code>~/bin</code>.</p> <h2 id="conclusion">Conclusion</h2> <p>RxSwift for scripting is a probably an uncommon idea but, then again, Swift for scripting is still catching on, too. This project is a demonstration of the possibilities of both while providing a practical tool that can be enjoyed now.</p> <hr /> <h2 id="release-notes">Release Notes</h2> <ul> <li>v1.0.0 First release verified with Xcode 8.3, Swift 3.1 and RxSwift 3.3.1.</li> <li>v1.0.1 Made sure that the presence of variable width encoded characters do not affect text matches.</li> <li>v1.0.2 Handled negative numbers. Fixed output to show only when duration is available.</li> <li>v1.0.3 Added reporting of detectsilence starts that have no end. Added retrieval of total duration. These changes handle the case where silence starts in the middle of a file and continues until the end.</li> <li>v1.0.4 Added a graphic rendering of silences that extend all the way to the end of a file.</li> <li>v1.0.5 Prevented sending a result with no values.</li> <li>v1.0.6 Reduced some extraneous code.</li> <li>v1.0.7 Further optimized Observable handling.</li> </ul> <h2 id="repositories">Repositories</h2> <p>The script has an open-source MIT license and repository links are here:</p> <ul> <li><a href="https://github.com/ikiapps/detectSilence">Github</a></li> <li><a href="https://bitbucket.org/ikiapps/detectsilence">Bitbucket</a></li> </ul> </div> <ul class="tag_box inline"> <li><i class="icon-folder-open"></i></li> <li><a href="/categories#open-source-ref"> open-source <span>1</span> </a></li> </ul> <ul class="tag_box inline"> <li><i class="icon-tags"></i></li> <li><a href="/tags#swift-ref">swift <span>12</span></a></li> <li><a href="/tags#rxswift-ref">rxswift <span>2</span></a></li> <li><a href="/tags#ffmpeg-ref">ffmpeg <span>1</span></a></li> <li><a href="/tags#silencedetect-ref">silencedetect <span>1</span></a></li> <li><a href="/tags#audio-ref">audio <span>1</span></a></li> <li><a href="/tags#reactive-programming-ref">reactive-programming <span>2</span></a></li> </ul> <hr> <ul class="pagination"> <li class="prev"><a href="/tutorials/2017/03/01/firebase-json-data-model-objects-swift" title="Make Model Objects from Firebase JSON Data in Swift">&larr; Previous</a></li> <li><a href="/archive">Archive</a></li> <li class="next"><a href="/reactive-programming/2017/05/15/promises-are-a-bridge-to-reactive" title="Chaining Reactive Operations versus Promise Chains">Next &rarr;</a></li> </ul> <hr> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_developer = 1; var disqus_shortname = 'ikiapps'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a> </div> </div> <hr/> <footer> <div style="float: left; margin-top: 10px; margin-bottom: 45px;"> &copy; 2019 ikiApps LLC</div> <div style="float: right; margin-top: 10px; margin-bottom: 40px;"><a href="/contact" target="_blank">Contact</a></div> <div style="float: left; margin-top: 10px; margin-bottom: 40px;"><hr/></div> </footer> </div> <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script> </body> </html>
