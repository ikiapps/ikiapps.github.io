<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <meta name="author" content="ikiApps LLC, 粋アプリ, d108(सोऽहम्)"> <meta name="description" content="Today, I have a look at Firebase security rules for the purpose of implementing user roles. I share a quick example that includes both a database and corresp..."> <title>Quickly Implement User Roles in Firebase</title> <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet"> <!--[if lt IE 9]> <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script> <![endif]--> <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed"> <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed"> <link rel="stylesheet" href="/css/main.css" type="text/css"> <link rel="canonical" href="/tutorials/2016/08/19/firebase-user-roles"> <link rel="shortcut icon" href="/favicon.ico"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40712418-2', 'auto'); ga('send', 'pageview'); </script> <script src="/js/jquery-3.2.0.min.js"></script> </head> <body> <nav class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <div class="navbar-image"><a href="/"><img src="/assets/themes/bootstrap/iki-circle-logo.png" width="40"/></a></div> <a class="navbar-brand" href="/">ikiApps</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href="/blog/">Blog</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/tags">Tags</a></li> <li><a href="/search/">Search</a></li> </ul> </div> </div> </nav> <div class="container"> <div class="page-header"> <h1>Quickly Implement User Roles in Firebase </h1> </div> <div class="row post-full"> <div class="col-md-12"> <div class="date"> <span>19 August 2016</span> </div> <div class="content"> <p>Today, I have a look at Firebase security rules for the purpose of implementing user roles. I share a quick example that includes both a database and corresponding rules to help you get up to speed with the format.</p> <p>There’s no convenient interface in Firebase where roles can be readily added. The semantics are instead defined both through the JSON database along with the logic in the security rules.</p> <p>Let’s say I have a <code>secret_data</code> path that I want to only be accessed only if a user is a <code>paid_user</code>.</p> <p>My database looks like this.</p> <figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="lineno"> 1 </span><span class="p">{</span>
<span class="lineno"> 2 </span>  <span class="nt">&quot;roles&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno"> 3 </span>    <span class="nt">&quot;admin_user&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno"> 4 </span>    <span class="nt">&quot;free_user&quot;</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="lineno"> 5 </span>    <span class="nt">&quot;paid_user&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno"> 6 </span>      <span class="nt">&quot;335Fq6U6gZPWNEyDJRZd6ZYGkvn1&quot;</span> <span class="p">:</span> <span class="kc">true</span>
<span class="lineno"> 7 </span>    <span class="p">}</span>
<span class="lineno"> 8 </span>  <span class="p">},</span>
<span class="lineno"> 9 </span>  <span class="nt">&quot;secret_data&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno">10 </span>    <span class="nt">&quot;access_code&quot;</span> <span class="p">:</span> <span class="mi">390399333</span><span class="p">,</span>
<span class="lineno">11 </span>    <span class="nt">&quot;users&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno">12 </span>      <span class="nt">&quot;335Fq6U6gZPWNEyDJRZd6ZYGkvn1&quot;</span> <span class="p">:</span> <span class="kc">true</span>
<span class="lineno">13 </span>    <span class="p">}</span>
<span class="lineno">14 </span>  <span class="p">},</span>
<span class="lineno">15 </span>  <span class="nt">&quot;users&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno">16 </span>    <span class="nt">&quot;335Fq6U6gZPWNEyDJRZd6ZYGkvn1&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno">17 </span>      <span class="nt">&quot;username&quot;</span> <span class="p">:</span> <span class="s2">&quot;test_user&quot;</span>
<span class="lineno">18 </span>    <span class="p">}</span>
<span class="lineno">19 </span>  <span class="p">}</span>
<span class="lineno">20 </span><span class="p">}</span></code></pre></figure> <p>The choice of where I place the roles is entirely up to me and how I want to work with my data. The only structure that is imposed on me is the JSON hierarchy.</p> <p>It helps to restrict all access by default. That is easily accomplished by making the top level read and write in the rules be both false (lines 2–4 below).</p> <p>Getting access to the <code>secret_data</code>, a path in my JSON database, involves setting up a boolean evaluation of the existence of my uid within the <code>paid_user</code> path.</p> <p>I look at the tree, starting at roles and descend into <code>paid_user</code> and check for the existence of my uid within that path (line 8 below).</p> <p>I’ve also added an additional check to verify that my uid also appears within the users that are authorized to access the secret data (line 9 below).</p> <p>In other words, the implementation of my security model can be as complex as I want it to be.</p> <p>There is an additional check of matching my uid to the logged-in user’s uid to be able to access any user information there (line 12 below).</p> <p>In this case, that additional check is completely redundant because the preceding logic will override anything below.</p> <p>That is why the top level read, write rules must be set to false.</p> <p>Here are the security rules as I’ve described them.</p> <figure class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="lineno"> 1 </span><span class="p">{</span>
<span class="lineno"> 2 </span>  <span class="nt">&quot;rules&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno"> 3 </span>    <span class="nt">&quot;.read&quot;</span>  <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="lineno"> 4 </span>    <span class="nt">&quot;.write&quot;</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="lineno"> 5 </span>    
<span class="lineno"> 6 </span>    <span class="err">//</span> <span class="err">Secret</span> <span class="err">data</span> <span class="err">is</span> <span class="err">only</span> <span class="err">available</span> <span class="err">to</span> <span class="err">paid</span> <span class="err">users.</span>
<span class="lineno"> 7 </span>    <span class="nt">&quot;secret_data&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno"> 8 </span>      <span class="nt">&quot;.read&quot;</span><span class="p">:</span> <span class="s2">&quot;(root.child(&#39;roles&#39;).child(&#39;paid_user&#39;).hasChild(auth.uid)) </span>
<span class="lineno"> 9 </span><span class="s2">                &amp;&amp; (data.child(&#39;users&#39;).hasChild(auth.uid))&quot;</span><span class="p">,</span>
<span class="lineno">10 </span>      <span class="nt">&quot;users&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno">11 </span>        <span class="nt">&quot;$uid&quot;</span> <span class="p">:</span> <span class="p">{</span>
<span class="lineno">12 </span>          <span class="nt">&quot;.read&quot;</span> <span class="p">:</span> <span class="s2">&quot;($uid === auth.uid)&quot;</span>
<span class="lineno">13 </span>        <span class="p">}</span>
<span class="lineno">14 </span>      <span class="p">}</span>
<span class="lineno">15 </span>    <span class="p">}</span>
<span class="lineno">16 </span>  <span class="p">}</span>
<span class="lineno">17 </span><span class="p">}</span></code></pre></figure> <p>In conclusion, Firebase allows creating just about any security model you want. The key to creating the rules is to look at your data and match the structure within your rules and then add the appropriate logic. Having a couple consoles open side-by-side facilitates this process.</p> <p>That’s it for my quick and easy introduction of how to approach making user roles in Firebase.</p> </div> <ul class="tag_box inline"> <li><i class="icon-folder-open"></i></li> <li><a href="/categories#tutorials-ref"> tutorials <span>3</span> </a></li> </ul> <ul class="tag_box inline"> <li><i class="icon-tags"></i></li> <li><a href="/tags#firebase-ref">firebase <span>3</span></a></li> <li><a href="/tags#security-ref">security <span>1</span></a></li> <li><a href="/tags#json-ref">json <span>3</span></a></li> </ul> <hr> <ul class="pagination"> <li class="prev"><a href="/tutorials/2016/07/21/ubuntu-vm-samba-mac" title="Fastest Setup of Samba in an Ubuntu Server Virtual Machine on a Mac">&larr; Previous</a></li> <li><a href="/archive">Archive</a></li> <li class="next"><a href="/tutorials/2017/03/01/firebase-json-data-model-objects-swift" title="Make Model Objects from Firebase JSON Data in Swift">Next &rarr;</a></li> </ul> <hr> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_developer = 1; var disqus_shortname = 'ikiapps'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a> </div> </div> <hr/> <footer> <div style="float: left; margin-top: 10px; margin-bottom: 45px;"> &copy; 2019 ikiApps LLC</div> <div style="float: right; margin-top: 10px; margin-bottom: 40px;"><a href="/contact" target="_blank">Contact</a></div> <div style="float: left; margin-top: 10px; margin-bottom: 40px;"><hr/></div> </footer> </div> <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script> </body> </html>
