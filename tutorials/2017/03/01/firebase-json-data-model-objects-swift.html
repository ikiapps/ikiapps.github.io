<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <meta name="author" content="ikiApps LLC, 粋アプリ, d108(सोऽहम्)"> <meta name="description" content="Your app’s data model defines the value that you are going to deliver to the world through your creation. The kinds of information we can consume or create w..."> <title>Make Model Objects from Firebase JSON Data in Swift</title> <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet"> <!--[if lt IE 9]> <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script> <![endif]--> <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed"> <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed"> <link rel="stylesheet" href="/css/main.css" type="text/css"> <link rel="canonical" href="/tutorials/2017/03/01/firebase-json-data-model-objects-swift"> <link rel="shortcut icon" href="/favicon.ico"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40712418-2', 'auto'); ga('send', 'pageview'); </script> <script src="/js/jquery-3.2.0.min.js"></script> </head> <body> <nav class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <div class="navbar-image"><a href="/"><img src="/assets/themes/bootstrap/iki-circle-logo.png" width="40"/></a></div> <a class="navbar-brand" href="/">ikiApps</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href="/blog/">Blog</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/tags">Tags</a></li> <li><a href="/search/">Search</a></li> </ul> </div> </div> </nav> <div class="container"> <div class="page-header"> <h1>Make Model Objects from Firebase JSON Data in Swift <br/><small>Do It Without Using Tedious If-Lets for Unwrapping</small></h1> </div> <div class="row post-full"> <div class="col-md-12"> <div class="date"> <span>01 March 2017</span> </div> <div class="content"> <p>Your app’s data model defines the value that you are going to deliver to the world through your creation. The kinds of information we can consume or create with your app are enabled by this fundamental software component. It tells us whether your app can serve a gourmet palate or if it is only there to be a snack.</p> <p>While being one of your app’s most important parts, it can be boring to implement. The code typically only involves transforming data from one type to another in a repetitive manner and this can end up being tedious to implement. However, I want to show you that making model objects can still be interesting and exciting and not just a routine task.</p> <h2 id="heres-what-i-cover">Here’s What I Cover</h2> <ul> <li>I discuss model objects in terms of integrating Swift with Firebase. The model objects in Swift will correspond to a JSON data model implemented in Firebase. I will use actual burial data from my NMCP Finder app for my example.</li> <li>I will show the long, tedious form of creating model objects using if-let unwrapping on each property.</li> <li>I will factor out the use of if-let for unwrapping.</li> <li>I will apply operator overloading to further reduce repetitive code when creating model objects.</li> </ul> <p>I am creating model objects through my own Swift code. I use a third-party library, <a href="https://github.com/SwiftyJSON/SwiftyJSON">SwiftyJSON</a>, to ease the retrieval of JSON data. There are other libraries that can go a step further and map your model objects to JSON. Some of these include <a href="https://github.com/thoughtbot/Argo">Argo</a>, <a href="https://github.com/Hearst-DD/ObjectMapper">ObjectMapper</a> and <a href="https://github.com/JohnSundell/Unbox">Unbox</a>. Their drawback is the loss of fine control and understanding you get when writing your own code along with having another dependency to maintain. With Swift 3, creating model objects can be efficient enough where there is not much to gain from employing a third-party library for this task.</p> <h2 id="json-schema-for-a-burial-model-object">JSON Schema for a Burial Model Object</h2> <p>Let’s have a look at the JSON that I will be using for my example. It is in a form that shows the keys and their value types. This is one way to establish a data model for Firebase.</p> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="lineno"> 1 </span><span class="p">{</span>
<span class="lineno"> 2 </span>    <span class="nx">burialID</span> <span class="o">:</span> <span class="p">{</span>
<span class="lineno"> 3 </span>      <span class="s2">&quot;birth&quot;</span> <span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="lineno"> 4 </span>      <span class="s2">&quot;branches&quot;</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">string</span> <span class="p">],</span>
<span class="lineno"> 5 </span>      <span class="s2">&quot;buriedAt&quot;</span> <span class="o">:</span> <span class="p">{</span>
<span class="lineno"> 6 </span>        <span class="s2">&quot;marker_id&quot;</span> <span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="lineno"> 7 </span>        <span class="s2">&quot;section&quot;</span> <span class="o">:</span> <span class="nx">string</span>
<span class="lineno"> 8 </span>      <span class="p">},</span>
<span class="lineno"> 9 </span>      <span class="s2">&quot;death&quot;</span> <span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="lineno">10 </span>      <span class="s2">&quot;firstName&quot;</span> <span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="lineno">11 </span>      <span class="s2">&quot;lastName&quot;</span> <span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="lineno">12 </span>      <span class="s2">&quot;middleNameAndOrOtherName&quot;</span> <span class="o">:</span> <span class="nx">string</span><span class="p">,</span>
<span class="lineno">13 </span>      <span class="s2">&quot;ranks&quot;</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">string</span> <span class="p">],</span>
<span class="lineno">14 </span>      <span class="s2">&quot;relatedAs&quot;</span> <span class="o">:</span> <span class="p">[</span> <span class="nx">string</span> <span class="p">]</span>
<span class="lineno">15 </span>    <span class="p">}</span>
<span class="lineno">16 </span><span class="p">}</span></code></pre></figure> <h2 id="making-a-swift-model-object">Making a Swift Model Object</h2> <p>It’s pretty straightforward to translate this JSON dictionary into a Swift struct. Here are the properties that correspond to the keys in the JSON schema.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="lineno"> 1 </span><span class="c1">/// A burial record.</span>
<span class="lineno"> 2 </span><span class="kd">struct</span> <span class="nc">Burial</span>
<span class="lineno"> 3 </span><span class="p">{</span>
<span class="lineno"> 4 </span>    <span class="kd">var</span> <span class="nv">birth</span>                    <span class="p">=</span> <span class="s">&quot;&quot;</span>
<span class="lineno"> 5 </span>    <span class="kd">var</span> <span class="nv">branches</span>                 <span class="p">=</span> <span class="p">[</span><span class="n">Branch</span><span class="p">]()</span>
<span class="lineno"> 6 </span>    <span class="kd">var</span> <span class="nv">buriedAt</span>                 <span class="p">=</span> <span class="n">BurialSite</span><span class="p">()</span>
<span class="lineno"> 7 </span>    <span class="kd">var</span> <span class="nv">death</span>                    <span class="p">=</span> <span class="s">&quot;&quot;</span>
<span class="lineno"> 8 </span>    <span class="kd">var</span> <span class="nv">firstName</span>                <span class="p">=</span> <span class="s">&quot;&quot;</span>
<span class="lineno"> 9 </span>    <span class="kd">var</span> <span class="nv">lastName</span>                 <span class="p">=</span> <span class="s">&quot;&quot;</span>
<span class="lineno">10 </span>    <span class="kd">var</span> <span class="nv">middleNameAndOrOtherName</span> <span class="p">=</span> <span class="s">&quot;&quot;</span>
<span class="lineno">11 </span>    <span class="kd">var</span> <span class="nv">ranks</span>                    <span class="p">=</span> <span class="p">[</span><span class="n">Rank</span><span class="p">]()</span>
<span class="lineno">12 </span>    <span class="kd">var</span> <span class="nv">relations</span>                <span class="p">=</span> <span class="p">[</span><span class="n">RelatedAs</span><span class="p">]()</span>
<span class="lineno">13 </span><span class="p">}</span></code></pre></figure> <p>The task is now to load the data from the JSON retrieved from Firebase into this native Swift data structure. Let’s first do it the long way using if-let unwrapping to get all the values from the JSON into our struct.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="lineno"> 1 </span><span class="c1">/// Init a Burial from raw JSON data retrieved from Firebase.</span>
<span class="lineno"> 2 </span><span class="kd">init</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">])</span>
<span class="lineno"> 3 </span><span class="p">{</span>
<span class="lineno"> 4 </span>    <span class="kd">let</span> <span class="nv">json</span> <span class="p">=</span> <span class="n">JSON</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">)</span>
<span class="lineno"> 5 </span>
<span class="lineno"> 6 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwBirth</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;birth&quot;</span><span class="p">].</span><span class="n">string</span> <span class="p">{</span>
<span class="lineno"> 7 </span>        <span class="kc">self</span><span class="p">.</span><span class="n">birth</span> <span class="p">=</span> <span class="n">uwBirth</span>
<span class="lineno"> 8 </span>    <span class="p">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwBranches</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;branches&quot;</span><span class="p">].</span><span class="n">arrayObject</span> <span class="p">{</span>
<span class="lineno">11 </span>        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">uwBranches</span> <span class="p">{</span>
<span class="lineno">12 </span>            <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwItem</span> <span class="p">=</span> <span class="n">item</span> <span class="k">as</span><span class="p">?</span> <span class="n">Branch</span> <span class="p">{</span>
<span class="lineno">13 </span>                <span class="kc">self</span><span class="p">.</span><span class="n">branches</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">uwItem</span><span class="p">)</span>
<span class="lineno">14 </span>            <span class="p">}</span>
<span class="lineno">15 </span>        <span class="p">}</span>
<span class="lineno">16 </span>    <span class="p">}</span>
<span class="lineno">17 </span>
<span class="lineno">18 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwBuriedAt</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;branches&quot;</span><span class="p">].</span><span class="n">dictionaryObject</span> <span class="k">as</span><span class="p">?</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">]</span> <span class="p">{</span>
<span class="lineno">19 </span>        <span class="kc">self</span><span class="p">.</span><span class="n">buriedAt</span> <span class="p">=</span> <span class="n">BurialSite</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">:</span> <span class="n">uwBuriedAt</span><span class="p">)</span>
<span class="lineno">20 </span>    <span class="p">}</span>
<span class="lineno">21 </span>
<span class="lineno">22 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwDeath</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;death&quot;</span><span class="p">].</span><span class="n">string</span> <span class="p">{</span>
<span class="lineno">23 </span>        <span class="kc">self</span><span class="p">.</span><span class="n">death</span> <span class="p">=</span> <span class="n">uwDeath</span>
<span class="lineno">24 </span>    <span class="p">}</span>
<span class="lineno">25 </span>
<span class="lineno">26 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwFirstName</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;firstName&quot;</span><span class="p">].</span><span class="n">string</span> <span class="p">{</span>
<span class="lineno">27 </span>        <span class="kc">self</span><span class="p">.</span><span class="n">firstName</span> <span class="p">=</span> <span class="n">uwFirstName</span>
<span class="lineno">28 </span>    <span class="p">}</span>
<span class="lineno">29 </span>
<span class="lineno">30 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwLastName</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;lastName&quot;</span><span class="p">].</span><span class="n">string</span> <span class="p">{</span>
<span class="lineno">31 </span>        <span class="kc">self</span><span class="p">.</span><span class="n">lastName</span> <span class="p">=</span> <span class="n">uwLastName</span>
<span class="lineno">32 </span>    <span class="p">}</span>
<span class="lineno">33 </span>
<span class="lineno">34 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwOtherName</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;firstName&quot;</span><span class="p">].</span><span class="n">string</span> <span class="p">{</span>
<span class="lineno">35 </span>        <span class="kc">self</span><span class="p">.</span><span class="n">middleNameAndOrOtherName</span> <span class="p">=</span> <span class="n">uwOtherName</span>
<span class="lineno">36 </span>    <span class="p">}</span>
<span class="lineno">37 </span>
<span class="lineno">38 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwRanks</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;ranks&quot;</span><span class="p">].</span><span class="n">arrayObject</span> <span class="p">{</span>
<span class="lineno">39 </span>        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">uwRanks</span> <span class="p">{</span>
<span class="lineno">40 </span>            <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwItem</span> <span class="p">=</span> <span class="n">item</span> <span class="k">as</span><span class="p">?</span> <span class="n">Rank</span> <span class="p">{</span>
<span class="lineno">41 </span>                <span class="kc">self</span><span class="p">.</span><span class="n">ranks</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">uwItem</span><span class="p">)</span>
<span class="lineno">42 </span>            <span class="p">}</span>
<span class="lineno">43 </span>        <span class="p">}</span>
<span class="lineno">44 </span>    <span class="p">}</span>
<span class="lineno">45 </span>
<span class="lineno">46 </span>    <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwRelatedAs</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;relatedAs&quot;</span><span class="p">].</span><span class="n">arrayObject</span> <span class="p">{</span>
<span class="lineno">47 </span>        <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="n">uwRelatedAs</span> <span class="p">{</span>
<span class="lineno">48 </span>            <span class="k">if</span> <span class="kd">let</span> <span class="nv">uwItem</span> <span class="p">=</span> <span class="n">item</span> <span class="k">as</span><span class="p">?</span> <span class="n">RelatedAs</span> <span class="p">{</span>
<span class="lineno">49 </span>                <span class="kc">self</span><span class="p">.</span><span class="n">relations</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">uwItem</span><span class="p">)</span>
<span class="lineno">50 </span>            <span class="p">}</span>
<span class="lineno">51 </span>        <span class="p">}</span>
<span class="lineno">52 </span>    <span class="p">}</span>
<span class="lineno">53 </span><span class="p">}</span></code></pre></figure> <p>Wow, the if-lets exploded all over the place for a relatively small number of fields. The resulting tedium of having to account for all of them is going to impact our productivity. If-let unwrapping causes so much fatigue because we have to create all those nonsensical temporary constants to hold the value that we want to use.</p> <h2 id="eliminating-if-let">Eliminating If-Let</h2> <blockquote> <p>Ideal code blocks are short and sweet, clear and concise about what they do.</p> </blockquote> <p><strong>Can we factor out the use of if-let?</strong> Yes, there are <em>other</em> ways to unwrap optionals. The Swift nil-coalescing infix operator consisting of double question marks (??) returns the unwrapped value of an optional if it is not nil. If it is nil, a default value is returned instead.</p> <p>By assigning all the optional values to temporary constants, we can use this operator to quickly unwrap all of the values. Furthermore, the complex values of arrays and dictionaries can be passed to helper functions as needed.</p> <p>The following code uses the nil-coalescing operator to unwrap the optional values and is a significant reduction of the if-let mess previously shown.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="lineno"> 1 </span><span class="c1">/// Init a Burial from raw JSON data retrieved from Firebase.</span>
<span class="lineno"> 2 </span><span class="kd">init</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">])</span>
<span class="lineno"> 3 </span><span class="p">{</span>
<span class="lineno"> 4 </span>    <span class="kd">let</span> <span class="nv">json</span>      <span class="p">=</span> <span class="n">JSON</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="kd">let</span> <span class="nv">birth</span>     <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;birth&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno"> 6 </span>    <span class="kd">let</span> <span class="nv">branches</span>  <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;branches&quot;</span><span class="p">].</span><span class="n">arrayObject</span>
<span class="lineno"> 7 </span>    <span class="kd">let</span> <span class="nv">buriedAt</span>  <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;buriedAt&quot;</span><span class="p">].</span><span class="n">dictionaryObject</span>
<span class="lineno"> 8 </span>    <span class="kd">let</span> <span class="nv">death</span>     <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;death&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno"> 9 </span>    <span class="kd">let</span> <span class="nv">firstName</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;firstName&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno">10 </span>    <span class="kd">let</span> <span class="nv">lastName</span>  <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;lastName&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno">11 </span>    <span class="kd">let</span> <span class="nv">otherName</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;middleNameAndOrOtherName&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno">12 </span>    <span class="kd">let</span> <span class="nv">ranks</span>     <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;ranks&quot;</span><span class="p">].</span><span class="n">arrayObject</span>
<span class="lineno">13 </span>    <span class="kd">let</span> <span class="nv">relatedAs</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;relatedAs&quot;</span><span class="p">].</span><span class="n">arrayObject</span>
<span class="lineno">14 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">birth</span> <span class="p">=</span> <span class="n">birth</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
<span class="lineno">15 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">branches</span> <span class="p">=</span> <span class="n">branches</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeBranches</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="p">[</span><span class="n">Branch</span><span class="p">]()</span>
<span class="lineno">16 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">buriedAt</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeBurialSite</span><span class="p">(</span><span class="n">buriedAt</span><span class="p">)</span>
<span class="lineno">17 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">death</span> <span class="p">=</span> <span class="n">death</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
<span class="lineno">18 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">firstName</span> <span class="p">=</span> <span class="n">firstName</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
<span class="lineno">19 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">lastName</span> <span class="p">=</span> <span class="n">lastName</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
<span class="lineno">20 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">middleNameAndOrOtherName</span> <span class="p">=</span> <span class="n">otherName</span> <span class="p">??</span> <span class="s">&quot;&quot;</span>
<span class="lineno">21 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">ranks</span> <span class="p">=</span> <span class="n">ranks</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeRanks</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="p">[</span><span class="n">Rank</span><span class="p">]()</span>
<span class="lineno">22 </span>    <span class="kc">self</span><span class="p">.</span><span class="n">relations</span> <span class="p">=</span> <span class="n">relatedAs</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeBurialRelations</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="p">[</span><span class="n">RelatedAs</span><span class="p">]()</span>
<span class="lineno">23 </span><span class="p">}</span></code></pre></figure> <p>It’s still not quite ideal, is it? There’s still some extraneous creation of constants going on.</p> <h2 id="operator-overloading">Operator Overloading</h2> <p>The temporary constants can be eliminated through the use of an infix operator that assigns the optional value from the JSON directly into the model object. For example, for our <code>birth</code> key in our Burial object, the function syntax will be:</p><pre><code>self.birth &lt;= json["birth"].string
</code></pre><p>The code to achieve that operator overloading uses Swift generics to represent the types. The left argument is defined as <code>inout</code> so that the property that is passed in can be mutated.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="lineno">1 </span><span class="kr">infix</span> <span class="kd">operator</span> <span class="o">&lt;=</span>
<span class="lineno">2 </span>
<span class="lineno">3 </span><span class="c1">/// Unwrap the right into the left or return the original value of the left.</span>
<span class="lineno">4 </span><span class="kd">func</span> <span class="o">&lt;=&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kr">left</span><span class="p">:</span> <span class="kr">inout</span> <span class="n">T</span><span class="p">,</span>
<span class="lineno">5 </span>           <span class="kr">right</span><span class="p">:</span> <span class="n">T</span><span class="p">?)</span>
<span class="lineno">6 </span><span class="p">{</span>
<span class="lineno">7 </span>    <span class="kr">left</span> <span class="p">=</span> <span class="kr">right</span> <span class="p">??</span> <span class="kr">left</span>
<span class="lineno">8 </span><span class="p">}</span></code></pre></figure> <p>Putting that operator into practice is going to alleviate the need to set up any temporary constants and let’s us assign values to our properties directly from the optionals contained in the JSON data.</p> <p>The final result of applying the techniques of the nil-coalescing operator and our own unwrapping assignment operator is a dramatic lessening of the code needed to unwrap all of the optional values from the burial data retrieved from Firebase.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="lineno"> 1 </span><span class="c1">/// Init a Burial from raw JSON data retrieved from Firebase.</span>
<span class="lineno"> 2 </span><span class="kd">init</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">:</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">])</span>
<span class="lineno"> 3 </span><span class="p">{</span>
<span class="lineno"> 4 </span>    <span class="kd">let</span> <span class="nv">json</span> <span class="p">=</span> <span class="n">JSON</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">)</span>
<span class="lineno"> 5 </span>    <span class="n">birth</span> <span class="o">&lt;=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;birth&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno"> 6 </span>    <span class="n">firstName</span> <span class="o">&lt;=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;firstName&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno"> 7 </span>    <span class="n">branches</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;branches&quot;</span><span class="p">].</span><span class="n">arrayObject</span><span class="p">.</span><span class="bp">map</span>
<span class="lineno"> 8 </span>               <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeBranches</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="p">[</span><span class="n">Branch</span><span class="p">]()</span>
<span class="lineno"> 9 </span>    <span class="n">buriedAt</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;buriedAt&quot;</span><span class="p">].</span><span class="n">dictionaryObject</span><span class="p">.</span><span class="bp">map</span>
<span class="lineno">10 </span>               <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeBurialSite</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="n">BurialSite</span><span class="p">()</span>
<span class="lineno">11 </span>    <span class="n">death</span> <span class="o">&lt;=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;death&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno">12 </span>    <span class="n">lastName</span> <span class="o">&lt;=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;lastName&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno">13 </span>    <span class="n">middleNameAndOrOtherName</span> <span class="o">&lt;=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;middleNameAndOrOtherName&quot;</span><span class="p">].</span><span class="n">string</span>
<span class="lineno">14 </span>    <span class="n">ranks</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;ranks&quot;</span><span class="p">].</span><span class="n">arrayObject</span><span class="p">.</span><span class="bp">map</span>
<span class="lineno">15 </span>            <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeRanks</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="p">[</span><span class="n">Rank</span><span class="p">]()</span>
<span class="lineno">16 </span>    <span class="n">relations</span> <span class="p">=</span> <span class="n">json</span><span class="p">[</span><span class="s">&quot;relatedAs&quot;</span><span class="p">].</span><span class="n">arrayObject</span><span class="p">.</span><span class="bp">map</span>
<span class="lineno">17 </span>                <span class="p">{</span> <span class="kc">self</span><span class="p">.</span><span class="n">makeBurialRelations</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span> <span class="p">??</span> <span class="p">[</span><span class="n">RelatedAs</span><span class="p">]()</span>
<span class="lineno">18 </span><span class="p">}</span></code></pre></figure> <p>Each assignment could easily fit on one line but I’ve chosen to spread out the closures to a second line for additional clarity.</p> <h2 id="helper-functions">Helper Functions</h2> <p>Finally, here is the code for the helper functions that I use to create the complex data structures of Swift arrays and dictionaries used in my model object. They also use the nil-coalescing operator to unwrap the array members that come back from Firebase. Arrays are processed using the native <code>map</code> in Swift. The burial site dictionary data is used to create a <code>BurialSite</code> model object that is implemented in a similar way to a <code>Burial</code>.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="lineno"> 1 </span><span class="kd">extension</span> <span class="nc">Burial</span>
<span class="lineno"> 2 </span><span class="p">{</span>
<span class="lineno"> 3 </span>    <span class="c1">/// Handles buriedAt is nil and handles failed cast to [String: AnyObject].</span>
<span class="lineno"> 4 </span>    <span class="kd">func</span> <span class="nf">makeBurialSite</span><span class="p">(</span><span class="kc">_</span> <span class="n">buriedAt</span><span class="p">:</span> <span class="nb">Any</span><span class="p">?)</span> <span class="p">-&gt;</span> <span class="n">BurialSite</span>
<span class="lineno"> 5 </span>    <span class="p">{</span>
<span class="lineno"> 6 </span>        <span class="kd">let</span> <span class="nv">jsonDict</span> <span class="p">=</span> <span class="n">buriedAt</span> <span class="k">as</span><span class="p">?</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span> <span class="nb">AnyObject</span><span class="p">]</span>
<span class="lineno"> 7 </span>        <span class="k">return</span> <span class="p">(</span><span class="n">jsonDict</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">?</span> <span class="n">BurialSite</span><span class="p">(</span><span class="n">jsonDictionary</span><span class="p">:</span> <span class="n">jsonDict</span><span class="p">!)</span> <span class="p">:</span> <span class="n">BurialSite</span><span class="p">();</span>
<span class="lineno"> 8 </span>    <span class="p">}</span>
<span class="lineno"> 9 </span>
<span class="lineno">10 </span>    <span class="kr">mutating</span> <span class="kd">func</span> <span class="nf">makeRanks</span><span class="p">(</span><span class="kc">_</span> <span class="n">rankArray</span><span class="p">:</span> <span class="p">[</span><span class="nb">Any</span><span class="p">])</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">Rank</span><span class="p">]</span>
<span class="lineno">11 </span>    <span class="p">{</span>
<span class="lineno">12 </span>        <span class="k">return</span> <span class="n">rankArray</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="k">as</span><span class="p">?</span> <span class="n">Rank</span> <span class="p">??</span> <span class="s">&quot;&quot;</span> <span class="p">};</span>
<span class="lineno">13 </span>    <span class="p">}</span>
<span class="lineno">14 </span>
<span class="lineno">15 </span>    <span class="kr">mutating</span> <span class="kd">func</span> <span class="nf">makeBranches</span><span class="p">(</span><span class="kc">_</span> <span class="n">branchesArray</span><span class="p">:</span> <span class="p">[</span><span class="nb">Any</span><span class="p">])</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">Branch</span><span class="p">]</span>
<span class="lineno">16 </span>    <span class="p">{</span>
<span class="lineno">17 </span>        <span class="k">return</span> <span class="n">branchesArray</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="k">as</span><span class="p">?</span> <span class="n">Branch</span> <span class="p">??</span> <span class="s">&quot;&quot;</span> <span class="p">};</span>
<span class="lineno">18 </span>    <span class="p">}</span>
<span class="lineno">19 </span>
<span class="lineno">20 </span>    <span class="kr">mutating</span> <span class="kd">func</span> <span class="nf">makeBurialRelations</span><span class="p">(</span><span class="kc">_</span> <span class="n">relationsArray</span><span class="p">:</span> <span class="p">[</span><span class="nb">Any</span><span class="p">])</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">RelatedAs</span><span class="p">]</span>
<span class="lineno">21 </span>    <span class="p">{</span>
<span class="lineno">22 </span>        <span class="k">return</span> <span class="n">relationsArray</span><span class="p">.</span><span class="bp">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="k">as</span><span class="p">?</span> <span class="n">RelatedAs</span> <span class="p">??</span> <span class="s">&quot;&quot;</span> <span class="p">};</span>
<span class="lineno">23 </span>    <span class="p">}</span>
<span class="lineno">24 </span><span class="p">}</span></code></pre></figure> <h2 id="conclusion">Conclusion</h2> <p>In this exercise of eliminating if-let unwrapping to create a Swift model object from JSON data retrieved from Firebase, I’ve shown how straightforward and compact it can be to write our own mapping code. Our init of <code>init(jsonDictionary: [String: AnyObject])</code> was transformed from 53 lines down to a potential 14 by using some programming techniques found in Swift 3.</p> <p>The overall goal here was not to have the code take up the smallest amount of space. Rather, it was to reduce the nonsense of having to make <em>N</em> number of temporary constants for the <em>N</em> data keys we want when using if-let unwrapping. Employing the nil-coalescing operator (??) and operator overloading along with compact functional mapping allows us to accomplish a more concise result while separating the operations for creating a Swift model object into clear sections.</p> <p>There are many libraries that can create your model objects for you. I do not recommend using them until you have become proficient with creating your own model objects in standard Swift. You may discover, like me, that libraries are more of a hindrance than a help when it comes to implementing your data model. I started to make my model objects using Argo and came across some obscure errors involving the limits of function currying and decided the effort to debug them wasn’t worth it.</p> <p>With my method for creating model objects in Swift, I have total control over how every data item is used and all without a single if-let being used for unwrapping of that data. You would only know how beautiful that is if you have also reached the level of fatigue that I have from if-let unwrapping. Additionally, the reduction of third-party dependencies is refreshing. I have thereby shown how invigorating it can be to create your own model objects.</p> </div> <ul class="tag_box inline"> <li><i class="icon-folder-open"></i></li> <li><a href="/categories#tutorials-ref"> tutorials <span>3</span> </a></li> </ul> <ul class="tag_box inline"> <li><i class="icon-tags"></i></li> <li><a href="/tags#swift-ref">swift <span>12</span></a></li> <li><a href="/tags#firebase-ref">firebase <span>3</span></a></li> <li><a href="/tags#data-model-ref">data-model <span>1</span></a></li> <li><a href="/tags#json-ref">json <span>3</span></a></li> </ul> <hr> <ul class="pagination"> <li class="prev"><a href="/tutorials/2016/08/19/firebase-user-roles" title="Quickly Implement User Roles in Firebase">&larr; Previous</a></li> <li><a href="/archive">Archive</a></li> <li class="next"><a href="/open-source/2017/03/15/swift-script-for-detecting-silence-in-audio-files" title="A Swift Script for Detecting Silence in Audio Files">Next &rarr;</a></li> </ul> <hr> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_developer = 1; var disqus_shortname = 'ikiapps'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a> </div> </div> <hr/> <footer> <div style="float: left; margin-top: 10px; margin-bottom: 45px;"> &copy; 2019 ikiApps LLC</div> <div style="float: right; margin-top: 10px; margin-bottom: 40px;"><a href="/contact" target="_blank">Contact</a></div> <div style="float: left; margin-top: 10px; margin-bottom: 40px;"><hr/></div> </footer> </div> <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script> </body> </html>
