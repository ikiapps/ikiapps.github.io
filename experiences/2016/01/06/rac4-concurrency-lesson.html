<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <meta name="author" content="ikiApps LLC, 粋アプリ, d108(सोऽहम्)"> <meta name="description" content="You may come across this situation while working with RAC4:"> <title>ReactiveCocoa 4 Signals Teach Us an Important Lesson About Concurrency</title> <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet"> <!--[if lt IE 9]> <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script> <![endif]--> <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed"> <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed"> <link rel="stylesheet" href="/css/main.css" type="text/css"> <link rel="canonical" href="/experiences/2016/01/06/rac4-concurrency-lesson"> <link rel="shortcut icon" href="/favicon.ico"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40712418-2', 'auto'); ga('send', 'pageview'); </script> <script src="/js/jquery-3.2.0.min.js"></script> </head> <body> <nav class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <div class="navbar-image"><a href="/"><img src="/assets/themes/bootstrap/iki-circle-logo.png" width="40"/></a></div> <a class="navbar-brand" href="/">ikiApps</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href="/blog/">Blog</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/tags">Tags</a></li> <li><a href="/search/">Search</a></li> </ul> </div> </div> </nav> <div class="container"> <div class="page-header"> <h1>ReactiveCocoa 4 Signals Teach Us an Important Lesson About Concurrency </h1> </div> <div class="row post-full"> <div class="col-md-12"> <div class="date"> <span>06 January 2016</span> </div> <div class="content"> <p>You may come across this situation while working with RAC4:</p> <hr /> <p>You’ve created a Signal. You’ve setup a simple observer on the signal so that the values can be printed from it.</p> <p>For some reason, no matter what you try, the results do not get processed from the Signal.</p> <hr /> <p>Here is a trivial sample signal.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">func</span> <span class="nf">testSignal</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Signal</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">NoError</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Signal</span> <span class="p">{</span> <span class="n">observer</span> <span class="k">in</span>
        <span class="kd">var</span> <span class="nv">i</span> <span class="p">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
            <span class="n">observer</span><span class="p">.</span><span class="n">sendNext</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">i</span><span class="o">++</span>
        <span class="p">}</span>
        <span class="n">observer</span><span class="p">.</span><span class="n">sendCompleted</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>Here is a trivial observe action on the signal.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="kd">let</span> <span class="nv">printIt</span><span class="p">:</span> <span class="nb">String</span><span class="p">-&gt;()</span> <span class="p">=</span> <span class="p">{</span>
    <span class="n">it</span> <span class="k">in</span> <span class="bp">print</span><span class="p">(</span><span class="s">&quot;next </span><span class="si">\(</span><span class="n">next</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">testSignal</span><span class="p">().</span><span class="n">observeNext</span><span class="p">(</span><span class="n">printIt</span><span class="p">)</span></code></pre></figure> <p>Can you answer what the output will be? Remember, whatever you have tried has failed to produce any result. So the answer is, you get no output here.</p> <hr /> <p>Is it a bug? No.</p> <p>The reason is due to simple call order.</p> <p>When <code>observeNext()</code> is reached in the chain, <code>testSignal()</code> has already completed because it <strong>blocked</strong> the current thread.</p> <p>Making the signal values available requires that execution <strong>falls through</strong> to <code>observeNext()</code> before <code>testSignal()</code> completes.</p> <p>There is nothing to observe if the signal <strong>blocks</strong> the observation of the signal.</p> <p>This problem can be solved by redirecting the <code>sendNext()</code> calls to be asynchronous as in the following modified sample signal.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span></span><span class="c1">// Swiss cheese test signal: It has holes to fall through.</span>
<span class="c1">// dispatch_async() on the main thread is sufficient to allow falling through.</span>
<span class="kd">func</span> <span class="nf">testSignal</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Signal</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">NoError</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Signal</span> <span class="p">{</span> <span class="n">observer</span> <span class="k">in</span>
        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">())</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nv">i</span> <span class="p">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">{</span>
                <span class="n">observer</span><span class="p">.</span><span class="n">sendNext</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">i</span><span class="o">++</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>The output now is:</p><pre><code>next 0
next 1
next 2
next 3
next 4
next 5
next 6
next 7
next 8
next 9
</code></pre><p>If you were having trouble understanding when individual operations are getting called in a signal chain, hopefully this post has helped you get past that. Consideration of sync vs async is rampant in iOS and OS X development and extremely important to recognize.</p> <p>In simple terms, either an operation is <strong>blocking</strong> or it allows <strong>falling through</strong> to the next operation.</p> <p>Libraries like RAC4 that help to make creating software more efficient by leveraging alternative concurrency paradigms especially require this discernment.</p> </div> <ul class="tag_box inline"> <li><i class="icon-folder-open"></i></li> <li><a href="/categories#experiences-ref"> experiences <span>6</span> </a></li> </ul> <ul class="tag_box inline"> <li><i class="icon-tags"></i></li> <li><a href="/tags#reactivecocoa-4-ref">reactivecocoa-4 <span>4</span></a></li> <li><a href="/tags#swift-ref">swift <span>12</span></a></li> <li><a href="/tags#ios-ref">ios <span>9</span></a></li> <li><a href="/tags#osx-ref">osx <span>8</span></a></li> <li><a href="/tags#asynchronous-operations-ref">asynchronous-operations <span>4</span></a></li> <li><a href="/tags#concurrency-ref">concurrency <span>3</span></a></li> </ul> <hr> <ul class="pagination"> <li class="prev"><a href="/experiences/2016/01/03/promises-in-ios" title="My First Peek at Promises in Swift on iOS and OS X">&larr; Previous</a></li> <li><a href="/archive">Archive</a></li> <li class="next"><a href="/tips/2016/01/10/cancel-button-for-google-drive-login" title="Making It So Users Can Cancel a Google Drive Login on iOS 9">Next &rarr;</a></li> </ul> <hr> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_developer = 1; var disqus_shortname = 'ikiapps'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a> </div> </div> <hr/> <footer> <div style="float: left; margin-top: 10px; margin-bottom: 45px;"> &copy; 2019 ikiApps LLC</div> <div style="float: right; margin-top: 10px; margin-bottom: 40px;"><a href="/contact" target="_blank">Contact</a></div> <div style="float: left; margin-top: 10px; margin-bottom: 40px;"><hr/></div> </footer> </div> <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script> </body> </html>
