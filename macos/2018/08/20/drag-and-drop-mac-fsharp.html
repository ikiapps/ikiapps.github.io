<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width initial-scale=1"> <meta name="author" content="ikiApps LLC, 粋アプリ, d108(सोऽहम्)"> <meta name="description" content=" Figure 1: Dragging-and-Dropping multiple files into a window from the Finder. "> <title>Drag-and-Drop for macOS in F#</title> <link href="/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet"> <!--[if lt IE 9]> <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script> <![endif]--> <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed"> <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed"> <link rel="stylesheet" href="/css/main.css" type="text/css"> <link rel="canonical" href="/macos/2018/08/20/drag-and-drop-mac-fsharp"> <link rel="shortcut icon" href="/favicon.ico"> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40712418-2', 'auto'); ga('send', 'pageview'); </script> <script src="/js/jquery-3.2.0.min.js"></script> </head> <body> <nav class="navbar navbar-default" role="navigation"> <div class="container"> <div class="navbar-header"> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <div class="navbar-image"><a href="/"><img src="/assets/themes/bootstrap/iki-circle-logo.png" width="40"/></a></div> <a class="navbar-brand" href="/">ikiApps</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href="/blog/">Blog</a></li> <li><a href="/archive">Archive</a></li> <li><a href="/tags">Tags</a></li> <li><a href="/search/">Search</a></li> </ul> </div> </div> </nav> <div class="container"> <div class="page-header"> <h1>Drag-and-Drop for macOS in F# </h1> </div> <div class="row post-full"> <div class="col-md-12"> <div class="date"> <span>Updated on 20 August 2018</span> </div> <div class="content"> <p> <figure class="image"><img src="/img/2018-08-20-drag-and-drop-mac-fsharp/dndintowindow.png" alt="Figure 1: Dragging-and-Dropping multiple files into a window from the Finder." /> <figcaption><strong>Figure 1: Dragging-and-Dropping multiple files into a window from the Finder.</strong> </figcaption> </figure> </p> <p>File handling can be accomplished through scripts and the command line but there is a satisfaction and practicality to the desktop metaphor that cannot be denied. This post is about implementing multiple file drag-and-drop, the non-deprecated way, from the Finder in macOS with F#.</p> <h3 id="what-can-you-get-from-this">What can you get from this?</h3> <p>A real Mac app created with Visual Studio for Mac and Xamarin that can process multiple files dragged into it from the Finder.</p> <h3 id="who-is-this-written-for">Who is this written for?</h3> <p>This article is written for someone having at least a little iOS/macOS SDK experience and who as an interest in life outside of the beautiful, walled garden of those SDKs.</p> <h3 id="why-f">Why F#?</h3> <p>Statically typed functional programming (FP) tends to lead to more correct software due to its logic being being more mathematical along with some additional benefits including the following:</p> <ul> <li>The compiler becomes your friend because of strong types.</li> <li>Favoring pure functions reduces side-effects, that can make debugging/maintenance difficult.</li> <li>Reduction in the overall quantity of code.</li> </ul> <p>FP may also expand your ingrained imperative programming thought processes so that working with functional paradigms becomes more natural.</p> <p>Of all the functional languages, F# allows targeting a wide range of mainstream platforms (iOS/Android/macOS/Windows) with its runtime. This increases its practical value.</p> <p>And if you can handle sarcasm, there are even <a href="https://fsharpforfunandprofit.com/posts/ten-reasons-not-to-use-a-functional-programming-language/">more reasons!</a></p> <h3 id="implementing-drag-and-drop-in-f">Implementing drag-and-drop in F#</h3> <p>When searching for <strong>multi-file drag-and-drop</strong> examples, <a href="https://stackoverflow.com/questions/44537356/swift-4-nsfilenamespboardtype-not-available-what-to-use-instead-for-registerfo/51344295#51344295">you may come across the <strong>deprecated global variable</strong> <code>NSFilenamesPboardType</code></a>. The equivalent Xamarin symbol is <code>NSPasteboard.NSFilenamesType</code>. Since the former symbol does not exist in Swift 4, some have suggested a workaround of hardcoding the string as “NSFilenamesPboardType” or using the alternate string <code>kUTTypeFileURL</code>.</p> <p>In conclusion, using one of these strings</p> <ul> <li><code>NSFilenamesPboardType</code></li> <li><code>"NSFilenamesPboardType"</code></li> <li><code>NSPasteboard.NSFilenamesType</code></li> <li><code>kUTTypeFileURL</code></li> </ul> <p>in <code>registerForDraggedTypes(_ newTypes: [NSPasteboard.PasteboardType])</code> should allow an <code>NSDraggingDestination</code> receiver, such as an <code>NSView</code> or <code>NSCollectionView</code>, access to multiple dragged files.</p> <p>However, the global variable <code>NSFilenamesPboardType</code> is <a href="https://developer.apple.com/documentation/appkit/nsfilenamespboardtype">deprecated according to Apple</a> thereby suggesting that an alternative should be sought.</p> <p>The symbol appears to have been introduced in 10.10, deprecated since 10.13 and will be removed after 10.14. The immediate <a href="https://developer.apple.com/documentation/appkit/nsfilenamespboardtype">documentation on the variable</a> wasn’t a help in knowing what to use in place of it.</p> <p>However, a <a href="http://codeworkshop.net/objc-diff/sdkdiffs/macos/10.14/AppKit.html">diff of <code>NSPasteboard.h</code></a> kindly provided by Matt Stevens has a suggestion that leads to a solution.</p> <table class="documentTable"> <thead> <tr> <th style="text-align: center"> </th> <th style="text-align: center">Availability</th> <th>Deprecation Message</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">From</td> <td style="text-align: center">Available</td> <td><em>none</em></td> </tr> <tr> <td style="text-align: center">To</td> <td style="text-align: center">Deprecated</td> <td>Create multiple pasteboard items with NSPasteboardTypeFileURL or kUTTypeFileURL instead</td> </tr> </tbody> </table> <p>For convenience, it would be nice to get the file URLs into an array. That requires handing the URL type to <code>readObjects(forClasses:options:)</code>. The code is shown here as parting of <code>draggingEnded</code> on the <code>NSDraggingDestination</code> implemented in <code>DNDView.fs</code>.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// DNDView.fs</span>

    <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nf">DraggingEnded</span><span class="o">(</span><span class="n">sender</span><span class="o">)</span> <span class="o">=</span>
        <span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NSDictionary</span><span class="bp">()</span>
        <span class="k">let</span> <span class="nv">t</span> <span class="o">=</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="n">NSUrl</span><span class="o">&gt;</span>
        <span class="k">let</span> <span class="nv">types</span><span class="o">:</span> <span class="n">Class</span><span class="bp">[]</span> <span class="o">=</span> <span class="o">[|</span> <span class="k">new</span> <span class="n">Class</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">|]</span>
        <span class="k">let</span> <span class="nv">objs</span> <span class="o">=</span>
            <span class="n">sender</span>
                <span class="o">.</span><span class="n">DraggingPasteboard</span>
                <span class="o">.</span><span class="n">ReadObjectsForClasses</span><span class="o">(</span><span class="n">types</span><span class="o">,</span> <span class="n">dict</span><span class="o">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="k">in</span> <span class="n">objs</span> <span class="k">do</span>
            <span class="n">this</span><span class="o">.</span><span class="n">filecnt</span> <span class="o">&lt;-</span> <span class="n">this</span><span class="o">.</span><span class="n">filecnt</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">this</span><span class="o">.</span><span class="n">updatefn</span><span class="o">(</span><span class="n">this</span><span class="o">.</span><span class="n">filecnt</span><span class="o">)</span>
            <span class="n">printfn</span> <span class="s">&quot;%s&quot;</span> <span class="o">(</span><span class="n">o</span> <span class="o">:?&gt;</span> <span class="n">NSUrl</span><span class="o">).</span><span class="n">Path</span> <span class="c1">// log the paths</span></code></pre></figure> <hr /> <h3 id="overriding-an-init-in-the-macos-sdk">Overriding an init in the macOS SDK</h3> <p>In getting started with the surrounding app that supports the drag-and-drop operations, the trickiest part was getting the constructor to override <code>init(coder:)</code>, the init called when bringing up a view from the storyboard.</p> <p>F# has <a href="http://www.codingwithsam.com/2017/09/25/fsharp-classes-23-view-models/">many different constructor forms</a> and I was not able to achieve the override by having a primary constructor even when setting a matching argument. The following code, for example, was not successful.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// DNDView.fs</span>

<span class="c1">// This primary constructor did not work to override init(coder:).</span>
<span class="o">[&lt;</span><span class="n">Register</span><span class="o">(</span><span class="s">&quot;DNDView&quot;</span><span class="o">)&gt;]</span>
<span class="k">type</span> <span class="nc">DNDView</span><span class="o">(</span><span class="n">coder</span><span class="o">:</span> <span class="n">NSCoder</span><span class="o">)</span> <span class="o">=</span>
    <span class="k">inherit</span> <span class="n">NSView</span><span class="o">(</span><span class="n">coder</span><span class="o">)</span></code></pre></figure> <p>Instead, the problem can be solved with an <strong>explicit constructor</strong> form. This differs from having a single, primary constructor by not setting any arguments in the initial constructor. This allows multiple init overrides even though I only needed to override one.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// DNDView.fs</span>

<span class="c1">// The primary constructor is generic here.</span>
<span class="o">[&lt;</span><span class="n">Register</span><span class="o">(</span><span class="s">&quot;DNDView&quot;</span><span class="o">)&gt;]</span>
<span class="k">type</span> <span class="nc">SNKView</span> <span class="o">=</span>
    <span class="k">inherit</span> <span class="n">NSView</span>

    <span class="c1">// Explicit constructors can override the needed macOS SDK inits.</span>
    <span class="o">[&lt;</span><span class="n">Export</span><span class="o">(</span><span class="s">&quot;initWithCoder:&quot;</span><span class="o">)&gt;]</span>
    <span class="k">new</span><span class="o">(</span><span class="n">coder</span><span class="o">:</span> <span class="n">NSCoder</span><span class="o">)</span> <span class="o">=</span> <span class="o">{</span>
        <span class="k">inherit</span> <span class="n">NSView</span><span class="o">(</span><span class="n">coder</span><span class="o">)</span>
    <span class="o">}</span></code></pre></figure> <p>The export attribute inside the square and angled brackets, [&lt; &gt;], tells the compiler what init to override. Note that it uses the Objective-C form of writing method signatures where the word “with” is included.</p> <p>Many Xamarin usages in F# involve translating from C# and that entails constraints that limit how something can be written. The full range of the F# language may not be available when it comes to translating code directly. For this case of constructor overriding, I don’t believe there is an another way to write this.</p> <h4 id="making-the-user-interface">Making the user interface</h4> <p>In contrast to the previous explicit constructor form, a view controller for the UI can be made using the primary form where it takes a single argument. It has a few text fields where one of them is updated with a count of the number of files that have been dropped into the app. These are now, with the explicit constructor form, defined as mutable <code>let</code> bindings and then added as subviews in a, hopefully, familiar <code>viewDidLoad</code> override.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// ViewController.fs</span>

<span class="o">[&lt;</span><span class="n">Register</span><span class="o">(</span><span class="s">&quot;ViewController&quot;</span><span class="o">)&gt;]</span>
<span class="k">type</span> <span class="nc">ViewController</span><span class="o">(</span><span class="n">handle</span><span class="o">:</span> <span class="n">IntPtr</span><span class="o">)</span> <span class="o">=</span>
    <span class="k">inherit</span> <span class="n">NSViewController</span><span class="o">(</span><span class="n">handle</span><span class="o">)</span>

    <span class="o">[&lt;</span><span class="n">DefaultValue</span><span class="o">&gt;]</span>
    <span class="k">val</span> <span class="k">mutable</span> <span class="n">tbHeight</span><span class="o">:</span> <span class="kt">float</span>

    <span class="k">let</span> <span class="nv">mutable</span> <span class="n">descText</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">NSTextField</span><span class="o">(</span>
            <span class="n">Frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CGRect</span> <span class="o">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">20</span><span class="o">.</span><span class="mi">0</span><span class="o">),</span>
            <span class="n">StringValue</span> <span class="o">=</span> <span class="s">&quot;File Count&quot;</span><span class="o">,</span>
            <span class="n">Editable</span> <span class="o">=</span> <span class="k">false</span><span class="o">,</span>
            <span class="n">Bezeled</span> <span class="o">=</span> <span class="k">false</span><span class="o">,</span>
            <span class="n">DrawsBackground</span> <span class="o">=</span> <span class="k">false</span><span class="o">,</span>
            <span class="n">Selectable</span> <span class="o">=</span> <span class="k">false</span><span class="o">)</span>
    <span class="k">let</span> <span class="nv">mutable</span> <span class="n">cntText</span> <span class="o">=</span>
        <span class="k">new</span> <span class="n">NSTextField</span><span class="o">(</span>
            <span class="n">Frame</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CGRect</span> <span class="o">(</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">.</span><span class="mi">0</span><span class="o">,</span> <span class="mi">20</span><span class="o">.</span><span class="mi">0</span><span class="o">),</span>
            <span class="n">StringValue</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">,</span>
            <span class="n">Editable</span> <span class="o">=</span> <span class="k">false</span><span class="o">,</span>
            <span class="n">Bezeled</span> <span class="o">=</span> <span class="k">false</span><span class="o">,</span>
            <span class="n">DrawsBackground</span> <span class="o">=</span> <span class="k">true</span><span class="o">,</span>
            <span class="n">Selectable</span> <span class="o">=</span> <span class="k">false</span><span class="o">)</span>

    <span class="o">[&lt;</span><span class="n">Outlet</span><span class="o">&gt;]</span>
    <span class="k">member</span> <span class="n">this</span><span class="p">.</span><span class="nf">CountField</span> <span class="k">with</span> <span class="n">get</span><span class="bp">()</span> <span class="o">=</span> <span class="n">cntText</span>
                           <span class="ow">and</span> <span class="n">set</span> <span class="n">value</span> <span class="o">=</span> <span class="n">cntText</span> <span class="o">&lt;-</span> <span class="n">value</span>

    <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nf">ViewDidLoad</span><span class="bp">()</span> <span class="o">=</span>
        <span class="k">base</span><span class="o">.</span><span class="n">ViewDidLoad</span><span class="bp">()</span>
        <span class="k">let</span> <span class="nv">v</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">View</span> <span class="o">:?&gt;</span> <span class="n">SNKView</span>
        <span class="n">this</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">AddSubview</span> <span class="o">(</span><span class="n">descText</span><span class="o">)</span>
        <span class="n">this</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">AddSubview</span> <span class="o">(</span><span class="n">cntText</span><span class="o">)</span>
        <span class="n">this</span><span class="o">.</span><span class="n">CountField</span><span class="o">.</span><span class="n">StringValue</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="kt">string</span><span class="o">)</span><span class="n">v</span><span class="o">.</span><span class="n">FileCount</span>
        <span class="n">v</span><span class="o">.</span><span class="n">UpdateView</span> <span class="o">&lt;-</span> <span class="k">fun</span> <span class="n">cnt</span> <span class="o">-&gt;</span> <span class="n">this</span><span class="o">.</span><span class="n">CountField</span><span class="o">.</span><span class="n">StringValue</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="kt">string</span><span class="o">)</span><span class="n">cnt</span></code></pre></figure> <h3 id="passing-data-between-components">Passing data between components</h3> <p>The text field <code>cntText</code> has an outlet that defines a getter and setter to be able to update the field with the count of files.</p> <p>The goal here is to have a loosely coupled architecture, allowing data to be passed between components while minimizing dependencies. In general, for MVC, views should not depend on the controllers using them.</p> <p>Delegation is a solution to this problem and is used throughout the iOS/macOS SDKs. It promotes composition over inheritance as a way of extending classes. Since F# is a functional language, <em>first class functions can be used to implement delegation</em> without the additional overhead of delegate protocols.</p> <p>The key idea of delegation is that the receiver can reference the <code>self</code> of the sender. I’ve left out that reference as I did not have a need for the full delegation pattern. For reference, there are <a href="http://rosettacode.org/wiki/Delegates#F_Sharp">nice comparative examples of delegation at Rosetta Code.</a></p> <p>For my solution, it is the following line inside the view controller that passes in an anonymous function to update the text field containing the count of files.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// ViewController.fs</span>

        <span class="n">v</span><span class="o">.</span><span class="n">UpdateView</span> <span class="o">&lt;-</span> <span class="k">fun</span> <span class="n">cnt</span> <span class="o">-&gt;</span> <span class="n">this</span><span class="o">.</span><span class="n">CountField</span><span class="o">.</span><span class="n">StringValue</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="kt">string</span><span class="o">)</span><span class="n">cnt</span></code></pre></figure> <p>This reads as the view’s update member, <code>UpdateView</code>, gets a lambda function with an argument <code>cnt</code> that sets the string value of the label showing the count. That’s astounding clarity for complex functionality that might take more code to express in other environments.</p> <p>That’s it! The DND view stays independent from the view controller and can be used anywhere while being able to update whoever decides to adopt it.</p> <h3 id="let-bindings-vs-vals">Let bindings vs vals</h3> <p>One F# language constraint is that the constructor form determines if <code>let</code> bindings are available in a class. When using explicit constructors, <code>val</code> is used instead of <code>let</code> to configure private backing variables or <strong>uninitialized fields</strong> for its members. These members can then be accessed externally.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// DNDView.fs</span>

    <span class="k">val</span> <span class="k">mutable</span> <span class="k">private</span> <span class="n">filecnt</span><span class="o">:</span> <span class="n">int</span>
    <span class="k">val</span> <span class="k">mutable</span> <span class="k">private</span> <span class="n">updatefn</span><span class="o">:</span> <span class="n">int</span> <span class="o">-&gt;</span> <span class="kt">unit</span></code></pre></figure> <p>These <code>val</code>s serve as the backing stores for the members (properties) defined in the following code.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// DNDView.fs</span>

    <span class="k">member</span> <span class="n">x</span><span class="p">.</span><span class="nf">FileCount</span>
        <span class="k">with</span> <span class="n">get</span><span class="bp">()</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">filecnt</span>
        <span class="ow">and</span> <span class="n">set</span><span class="o">(</span><span class="n">value</span><span class="o">:</span> <span class="n">int</span><span class="o">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">filecnt</span> <span class="o">&lt;-</span> <span class="n">value</span>
    <span class="k">member</span> <span class="n">x</span><span class="p">.</span><span class="nf">UpdateView</span>
        <span class="k">with</span> <span class="n">set</span><span class="o">(</span><span class="n">fn</span><span class="o">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">updatefn</span> <span class="o">&lt;-</span> <span class="n">fn</span></code></pre></figure> <p>The mutable <code>val</code>s can be function types indicated by a compact signature of the form: <code>type -&gt; type</code>.</p> <p>All together, the <code>DNDView</code> looks like the following code, showing the property definitions along with method overrides where the dragged types are handled. The snippet leaves out the <code>draggingEnded</code> method previously listed.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// DNDView.fs</span>

<span class="o">[&lt;</span><span class="n">Register</span><span class="o">(</span><span class="s">&quot;DNDView&quot;</span><span class="o">)&gt;]</span>
<span class="k">type</span> <span class="nc">DNDView</span> <span class="o">=</span>
    <span class="k">inherit</span> <span class="n">NSView</span>

    <span class="k">val</span> <span class="k">mutable</span> <span class="k">private</span> <span class="n">filecnt</span><span class="o">:</span> <span class="n">int</span>
    <span class="k">val</span> <span class="k">mutable</span> <span class="k">private</span> <span class="n">updatefn</span><span class="o">:</span> <span class="n">int</span> <span class="o">-&gt;</span> <span class="kt">unit</span>

    <span class="o">[&lt;</span><span class="n">Export</span><span class="o">(</span><span class="s">&quot;initWithCoder:&quot;</span><span class="o">)&gt;]</span>
    <span class="k">new</span><span class="o">(</span><span class="n">coder</span><span class="o">:</span> <span class="n">NSCoder</span><span class="o">)</span> <span class="o">=</span> <span class="o">{</span>
        <span class="k">inherit</span> <span class="n">NSView</span><span class="o">(</span><span class="n">coder</span><span class="o">)</span>
        <span class="n">filecnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">updatefn</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">cnt</span> <span class="o">-&gt;</span> <span class="bp">()</span>
    <span class="o">}</span>

    <span class="k">member</span> <span class="n">x</span><span class="p">.</span><span class="nf">FileCount</span> <span class="k">with</span> <span class="n">get</span><span class="bp">()</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">filecnt</span>
                       <span class="ow">and</span> <span class="n">set</span><span class="o">(</span><span class="n">value</span><span class="o">:</span> <span class="n">int</span><span class="o">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">filecnt</span> <span class="o">&lt;-</span> <span class="n">value</span>
    <span class="k">member</span> <span class="n">x</span><span class="p">.</span><span class="nf">UpdateView</span> <span class="k">with</span> <span class="n">set</span><span class="o">(</span><span class="n">fn</span><span class="o">)</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">updatefn</span> <span class="o">&lt;-</span> <span class="n">fn</span>

    <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nf">AwakeFromNib</span><span class="bp">()</span> <span class="o">=</span>
        <span class="k">base</span><span class="o">.</span><span class="n">AwakeFromNib</span><span class="bp">()</span>
        <span class="k">let</span> <span class="nv">types</span> <span class="o">=</span> <span class="o">(</span><span class="kt">string</span><span class="o">)</span><span class="nn">NSPasteboard</span><span class="p">.</span><span class="n">NSPasteboardTypeFileUrl</span>
        <span class="n">this</span><span class="o">.</span><span class="n">RegisterForDraggedTypes</span> <span class="o">[|</span> <span class="n">types</span> <span class="o">|]</span>

    <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nf">DraggingEntered</span><span class="o">(</span><span class="n">sender</span><span class="o">)</span> <span class="o">=</span>
        <span class="nn">NSDragOperation</span><span class="p">.</span><span class="n">Copy</span></code></pre></figure> <h3 id="handling-a-programmatic-ui">Handling a programmatic UI</h3> <p>For this example, I chose to generate a UI programmatically. I know it is possible to use the storyboard but I still have yet to determine the optimal method for using one with F#.</p> <p>The goal was to have a minimal, but functional, layout. The controls were recalculated based on the window size. NSViews in general have their origin at the lower left, this is different from iOS where it is the upper left corner. Performing the layout in <code>viewDidLayout</code> of the view controller allowed for maintaining the layout during such changes as window resizing. The additional code added to the view controller for this is shown below.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// ViewController.fs</span>

    <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nf">ViewDidLayout</span><span class="bp">()</span> <span class="o">=</span>
        <span class="k">base</span><span class="o">.</span><span class="n">ViewDidLayout</span><span class="bp">()</span>
        <span class="n">layoutViews</span><span class="o">(</span><span class="n">this</span><span class="o">,</span> <span class="n">cntText</span><span class="o">,</span> <span class="n">descText</span><span class="o">)</span>

    <span class="k">let</span> <span class="nv">layoutViews</span><span class="o">(</span><span class="n">this</span><span class="o">:</span> <span class="n">ViewController</span><span class="o">,</span>
                    <span class="n">cntText</span><span class="o">:</span> <span class="n">NSTextField</span><span class="o">,</span>
                    <span class="n">descText</span><span class="o">:</span> <span class="n">NSTextField</span><span class="o">)</span> <span class="o">=</span>
        <span class="k">let</span> <span class="nv">view_h</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">this</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Height</span>
        <span class="k">let</span> <span class="nv">margin</span> <span class="o">=</span> <span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
        <span class="n">descText</span><span class="o">.</span><span class="n">Frame</span> <span class="o">&lt;-</span> <span class="n">CGRect</span><span class="o">(</span>
            <span class="n">margin</span><span class="o">,</span>
            <span class="n">view_h</span>
          <span class="o">-</span> <span class="n">this</span><span class="o">.</span><span class="n">tbHeight</span>
          <span class="o">-</span> <span class="n">margin</span><span class="o">,</span>
            <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">descText</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Width</span><span class="o">,</span>
            <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">descText</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Height</span><span class="o">)</span>
        <span class="n">cntText</span><span class="o">.</span><span class="n">Frame</span> <span class="o">&lt;-</span> <span class="n">CGRect</span><span class="o">(</span>
            <span class="n">margin</span><span class="o">,</span>
            <span class="n">view_h</span>
          <span class="o">-</span> <span class="n">this</span><span class="o">.</span><span class="n">tbHeight</span>
          <span class="o">-</span> <span class="n">margin</span>
          <span class="o">-</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">descText</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Height</span><span class="o">,</span>
            <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">cntText</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Width</span><span class="o">,</span>
            <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">cntText</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Height</span><span class="o">)</span></code></pre></figure> <p>I really like the sub-indenting with offside formatting for mathematically arranging expressions with a binary operator, as seen above.</p> <h4 id="refining-the-dynamic-layout">Refining the dynamic layout</h4> <p>A window controller subclass was used solely for the purpose of being able to obtain the precise height value of the windows title bar by getting <code>contentRect(forBounds:)</code> and subtracting the content view frame height. The values are in units of abstract points, not pixels. The title bar height is saved into the VC.</p> <figure class="highlight"><pre><code class="language-fsharp" data-lang="fsharp"><span></span><span class="c1">// WindowController.fs</span>

<span class="o">[&lt;</span><span class="n">Register</span><span class="o">(</span><span class="s">&quot;WindowController&quot;</span><span class="o">)&gt;]</span>
<span class="k">type</span> <span class="nc">WindowController</span> <span class="o">=</span>
    <span class="k">inherit</span> <span class="n">NSWindowController</span>

    <span class="o">[&lt;</span><span class="n">Export</span><span class="o">(</span><span class="s">&quot;initWithCoder:&quot;</span><span class="o">)&gt;]</span>
    <span class="k">new</span><span class="o">(</span><span class="n">coder</span><span class="o">:</span> <span class="n">NSCoder</span><span class="o">)</span> <span class="o">=</span> <span class="o">{</span>
        <span class="k">inherit</span> <span class="n">NSWindowController</span><span class="o">(</span><span class="n">coder</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="k">override</span> <span class="n">this</span><span class="p">.</span><span class="nf">WindowDidLoad</span><span class="bp">()</span> <span class="o">=</span>
        <span class="k">base</span><span class="o">.</span><span class="n">WindowDidLoad</span><span class="bp">()</span>
        <span class="k">let</span> <span class="nv">vc</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">ContentViewController</span> <span class="o">:?&gt;</span> <span class="n">ViewController</span>
        <span class="k">let</span> <span class="nv">crh</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)(</span><span class="n">this</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">ContentRectFor</span><span class="o">(</span><span class="n">this</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">ContentView</span><span class="o">.</span><span class="n">Frame</span><span class="o">).</span><span class="n">Height</span><span class="o">)</span>
        <span class="n">vc</span><span class="o">.</span><span class="n">tbHeight</span> <span class="o">&lt;-</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">this</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">ContentView</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Height</span> <span class="o">-</span> <span class="n">crh</span></code></pre></figure> <h3 id="conclusion">Conclusion</h3> <p>This example demonstrated how to create a Mac app that handles multiple files dragged in from the Finder, using a non-deprecated approach, while using the F# language. It consisted of three classes: <code>ViewController</code>, <code>WindowController</code>, and <code>DNDView</code> were the latter conformed to <code>NSDraggingDestination</code>.</p> <p>Working in F# for macOS requires integrated knowledge that spans multiple languages. I recommend exploring it to learn functional programming principles that can lead to practical applications. It has an elegance that can benefit everything else you do. Stepping outside of the beautiful, walled garden of iOS/macOS can be scary at first, but the perspective gained will give you wings to fly over many technical challenges.</p> <p>F# reduces syntax with a mathematical kind of offside-rule formatting. It is indentation based where whitespace is significant like Python but function oriented like Scala. There are no braces for code blocks and no return statements for functions. After awhile the extra syntax required in other languages may seem strange when you have to use it again.</p> <p>It’s practically required to also know C#, the home language of most Xamarin examples and the assembly browser in Visual Studio for Mac. Being two to three levels removed from native iOS/macOS gives a unique perspective that can deepen understanding of diverse software principles.</p> <p>Just like with statically typed Swift, the compiler can light your way. Following its hints and errors allowed me to know enough about what is allowed to develop the project in a way that was more like solving an algebraic puzzle by satisfying one constraint at a time rather than writing out the verbose steps of an imperative recipe.</p> <p>Finally, this example was only meant as an introduction and there are many possible paths to be explored.</p> </div> <ul class="tag_box inline"> <li><i class="icon-folder-open"></i></li> <li><a href="/categories#macOS-ref"> macOS <span>1</span> </a></li> </ul> <ul class="tag_box inline"> <li><i class="icon-tags"></i></li> <li><a href="/tags#macos-ref">macos <span>1</span></a></li> <li><a href="/tags#f#-ref">f# <span>3</span></a></li> <li><a href="/tags#drag-and-drop-ref">drag-and-drop <span>1</span></a></li> <li><a href="/tags#swift-ref">swift <span>12</span></a></li> <li><a href="/tags#cocoa-ref">cocoa <span>1</span></a></li> </ul> <hr> <ul class="pagination"> <li class="prev"><a href="/machine-learning/2018/06/24/python-for-ml" title="Manage Python for Machine Learning on macOS">&larr; Previous</a></li> <li><a href="/archive">Archive</a></li> <li class="next"><a href="/programming/2019/05/29/kotlin-json-processing" title="Kotlin for Concise JSON Pre-Processing">Next &rarr;</a></li> </ul> <hr> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_developer = 1; var disqus_shortname = 'ikiapps'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a> </div> </div> <hr/> <footer> <div style="float: left; margin-top: 10px; margin-bottom: 45px;"> &copy; 2019 ikiApps LLC</div> <div style="float: right; margin-top: 10px; margin-bottom: 40px;"><a href="/contact" target="_blank">Contact</a></div> <div style="float: left; margin-top: 10px; margin-bottom: 40px;"><hr/></div> </footer> </div> <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script> </body> </html>
